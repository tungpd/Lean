# LEAN Architecture - ASCII Diagram

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                            LEAN Algorithmic Trading Engine                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           ALGORITHM LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐    ┌─────────────────────────────────────────┐         │
│  │  QCAlgorithm    │    │         ALGORITHM FRAMEWORK            │         │
│  │                 │    │                                         │         │
│  │  • Initialize() │    │  ┌─────────────┐  ┌─────────────────┐  │         │
│  │  • OnData()     │    │  │ Alpha       │  │ Portfolio       │  │         │
│  │  • OnOrderEvent()│   │  │ Models      │  │ Construction    │  │         │
│  │                 │    │  └─────────────┘  └─────────────────┘  │         │
│  └─────────────────┘    │                                         │         │
│                         │  ┌─────────────┐  ┌─────────────────┐  │         │
│  ┌─────────────────┐    │  │ Execution   │  │ Risk            │  │         │
│  │ Algorithm.CSharp│    │  │ Models      │  │ Management      │  │         │
│  └─────────────────┘    │  └─────────────┘  └─────────────────┘  │         │
│                         │                                         │         │
│  ┌─────────────────┐    │  ┌─────────────┐                        │         │
│  │ Algorithm.Python│    │  │ Universe     │                        │         │
│  └─────────────────┘    │  │ Selection    │                        │         │
│                         │  └─────────────┘                        │         │
└─────────────────────────┴─────────────────────────────────────────┴─────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            ENGINE LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐                                                      │
│  │ AlgorithmManager│ ◄─────────────────────────────────────────────────┐  │
│  │                 │                                                   │  │
│  │ • Event Loop    │                                                   │  │
│  │ • Time Slices   │                                                   │  │
│  │ • Coordination  │                                                   │  │
│  └─────────────────┘                                                   │  │
│       │       │       │       │       │                                 │  │
│       ▼       ▼       ▼       ▼       ▼                                 │  │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────────┐             │  │
│  │DataFeed│ │Transact│ │Result  │ │Setup   │ │RealTime    │             │  │
│  │        │ │Handler │ │Handler │ │Handler │ │Handler     │             │  │
│  └────────┘ └────────┘ └────────┘ └────────┘ └────────────┘             │  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DATA LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  BaseData   │  │   Symbol    │  │ Securities  │  │   Orders    │         │
│  │             │  │             │  │             │  │             │         │
│  │ • TradeBar  │  │ • Identity  │  │ • Holdings  │  │ • Market     │         │
│  │ • QuoteBar  │  │ • Metadata  │  │ • Margin    │  │ • Limit      │         │
│  │ • Tick      │  │             │  │ • Fees      │  │ • Stop       │         │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          BROKERAGE LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Interactive     │  │  Binance    │  │  Coinbase   │  │   Others    │     │
│  │ Brokers         │  │             │  │             │  │             │     │
│  └─────────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Config      │  │  Logging    │  │ Messaging   │  │   Queues    │         │
│  │             │  │             │  │             │  │             │         │
│  │ • config.json│  │ • Composite │  │ • Events     │  │ • Job Queue  │         │
│  │ • Environment│  │ • Handlers  │  │ • Status     │  │ • Processing │         │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              DATA FLOW                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  Market Data → DataFeed → AlgorithmManager → QCAlgorithm → Orders         │
│         ↓              ↓              ↓              ↓              ↓       │
│    Raw Data    Subscription    Processing    Strategy    Transaction       │
│                                                                          │
│  Orders → TransactionHandler → Brokerage → Market → ResultHandler → Storage│
│         ↓              ↓              ↓              ↓              ↓       │
│   Generated    Processing    Execution    Fill     Aggregation    Results │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        CONFIGURATION PATTERNS                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  Environment: backtesting → FileSystemDataFeed + BacktestingTransactionHandler│
│  Environment: live-paper  → LiveTradingDataFeed + BacktestingTransactionHandler│
│  Environment: live-ib     → LiveTradingDataFeed + BrokerageTransactionHandler │
│                                                                          │
│  Algorithm: CSharp/Python → Dynamic loading via AlgorithmFactory         │
│  Framework: Optional     → Modular models (Alpha, Portfolio, Execution)  │
└─────────────────────────────────────────────────────────────────────────────┘
```
```
```

